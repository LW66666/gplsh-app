<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>小区的通行记录</title>
    <link rel="stylesheet" type="text/css" href="../../../../css/api.css"/>

    <style>
        body, html {
            position: relative;
            background-color: #fff;
            font-size: 20px;
        }

        .time-block {
            width: 100%;
            overflow: hidden;
        }

        .time-block:first-child {
            padding-top: 20px;
        }

        .left-time {
            float: left;
            width: 20%;
        }

        .time-node {
            float: left;
            position: relative;
            overflow: hidden;
            width: 15px;
            height: auto;
            z-index: 0;
        }

        .time-node::before {
            z-index: -1;
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: inline-block;
            height: 100%;
            width: 2px;
            background-color: #b1b1b1;
        }

        .time-info {
            float: left;
            width: 70%;
        }

        .time-node .round:first-child {
            display: block;
            padding-top: 10px;
            background-color: #fff;
        }

        .time-node .round:first-child {
            background-color: #fff;
        }

        .time-node .round:first-child::after {
            margin-top: 0;
        }

        .round::after {
            content: "";
            z-index: 1;
            display: block;
            width: 6px;
            height: 6px;
            margin: 62.4px auto 0;
            border-radius: 50%;
            background-color: #4298fd;
        }

        .round-nice::after {
            content: "";
            background: #ffffff url("../../../../image/my/traffic/round_nice.png") no-repeat;
            background-size: 100% 100%;
            width: 12px;
            height: 12px;
        }

        .round-hidden {
            width: 100%;
            height: 100%;
            content: '';
            display: block;
            background-color: #fff;
        }

        .time-row {
            position: relative;
            box-sizing: border-box;
            font-size: 0.75rem;
            width: 100%;
            height: 32px;
            line-height: 32px;
            text-align: right;
            padding-right: 5px;
            margin-top: 36.4px;
        }

        .time-row:first-child {
            margin-top: -5px;
        }

        .time-row.inner {
            font-size: 0.625rem;
            color: #6b6a6a;
            line-height: 16px;
            margin-top: 42.4px;
        }

        .info-details:first-child {
            height: 63.5px;
        }

        .info-details {
            position: relative;
            width: 100%;
            height: 74.4px;
        }
        .info-details.empty{
            height: 67.4px;
        }

        .time-info .info-details.empty:first-child{
            height: 66px;
        }

        .info-details .info-left {
            width: calc(100% - 85px);
            padding-left: 5px;

        }

        .info-left div:first-child {
            font-size: 0.8125rem;
            font-weight: 500;
        }

        .info-left div:first-child > img {
            position: relative;
            top: 3px;
            padding-left: 2px;
            width: 0.8rem;
        }

        .info-left div:last-child {
            font-size: 0.6875rem;
            color: #757575;
        }

        .info-details > .avatar {
            position: absolute;
            top: 0;
            right: 5px;
            width: 75px;
            height: 57px;
        }

        .next-year {
            width: 100%;
            font-size: 0.625rem;
            height: 50px;
            line-height: 50px;
            text-align: center;
            color: #8b8b8b;
        }

        .empty-info {
            padding-top: 40%;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 55%;
            height: 100%;
            text-align: center;
        }

        .empty-info img {
            width: 70%;
        }

        .empty-info p {
            padding-top: 10px;
            text-align: center;
            color: #888888;
            font-size: .75rem;
        }
        .aui-hide{
            display: none;
        }
    </style>
</head>

<body>

<div id="app">

</div>

<div class="empty-info">
    <img src="../../../../image/empty/item-empty.png"/>
    <p>
        亲，你还没有单元通行记录哦~
    </p>
</div>
</body>

</html>
<script type="text/javascript" src="../../../../script/api.js"></script>
<script type="text/javascript" src="../../../../script/static.js"></script>
<script>
    apiready = function () {
        initItem();
    };

    function initItem() {
        var user = $api.getStorage(Static.USEROBJ);
        // api.alert({msg:JSON.stringify(user)});
        if (user.householdRoomList && user.householdRoomList[0] && user.householdRoomList[0].communityCode) {
            //这是有房子的人
            api.ajax({
                url: Static.IP + '/api/app/communitywanli/passThrough/listAccessControlByHouseHoldId',
                method: 'get',
                dataType: 'json',
                data: {
                    values: {
                        type: 'W',
                        cellphone: user.cellphone,
                        communityCode: user.householdRoomList[0].communityCode,
                        mac: api.deviceId
                    }
                }
            }, function (ret, err) {
                if (ret) {
                    if (!ret.resultStatus) {
                        api.toast({
                            msg: ret.message,
                            duration: 3000,
                            location: 'bottom'
                        });
                    } else {
                        var list = ret.object;
                        if (list && list.length > 0) {
                            var y = new Date().getFullYear().toString();
                            var m = list[0].accessTime.substring(5, 7);
                            var d = list[0].accessTime.substring(8, 10);
                            var all = ['<div class="time-block">'];
                            var $leftTime = ['<div class="left-time"><div class="time-row">'+ m + '-' + d + '</div>'];
                            var $timeNode = ['<div class="time-node"><i class="round"></i>'];
                            var $timeInfo = ['<div class="time-info"><div class="info-details empty"></div>'];

                            for (var i = 0; i < list.length; i++) {
                                var time = [
                                    list[i].accessTime.substring(0, 4),
                                    list[i].accessTime.substring(5, 7),
                                    list[i].accessTime.substring(8, 10)
                                ];

                                if (m !== time[1] || d !== time[2]) {
                                    $leftTime.push('<div class="time-row">' + time[1] + '-' + time[2] + '</div>');
                                    $timeNode.push('<i class="round"></i>');
                                    $timeInfo.push('<div class="info-details empty"></div>');
                                    m = time[1];
                                    d = time[2];
                                }
                                $leftTime.push('<div class="time-row inner">' + list[i].accessTime.substring(11, 16) + '<p class="row-details">' + getMsgByType(parseInt(list[i].interactiveType)) + '</p></div>');
                                $timeNode.push('<i class="round round-nice"></i>');
                                $timeInfo.push('<div class="info-details">' +
                                    '<div class="info-left">' +
                                    '<div>' + list[i].buildingName + list[i].unitName + '<img src="../../../../image/my/traffic/enter.png"/></div>' +
                                    '<div>' + list[i].communityName + list[i].zoneName + list[i].buildingName + list[i].unitName + '</div>' +
                                    '</div>' +
                                    '<img class="avatar" src="' + list[i].accessImgUrl + '"/>' +
                                    '</div>');

                                if (time[0] !== y) {
                                    all.push($leftTime.join('') + '</div>');
                                    all.push($timeNode.join('') + '<i class="round-hidden"></i></div>');
                                    all.push($timeInfo.join('') + '</div>');
                                    //非今年
                                    all.push('</div><div class="next-year">' + time[0] + '年</div>');
                                    y = time[0];
                                    all.push('<div class="time-block">');
                                    $leftTime = ['<div class="left-time">'];
                                    $timeNode = ['<div class="time-node">'];
                                    $timeInfo = ['<div class="time-info">'];
                                }

                            }
                            if (y === new Date().getFullYear().toString()) {
                                all.push($leftTime.join('') + '</div>');
                                all.push($timeNode.join('') + '<i class="round-hidden"></i></div>');
                                all.push($timeInfo.join('') + '</div>');
                                all.push('</div>');
                            }
                            api.alert({msg: JSON.stringify(all)});
                            $api.append($api.dom('#app'), all.join(''));
                        } else {
                            $api.removeCls($api.dom('.empty-info'), 'aui-hide');
                        }
                    }
                } else {
                    api.toast({
                        msg: err.msg,
                        duration: 3000,
                        location: 'bottom'
                    });
                }
            });
        } else {
            //没房子的
            $api.removeCls($api.dom('.empty-info'), 'aui-hide');
            $api.text($api.dom('#emptyTip'), '天呐，您还木有添加住宅~');
        }
    }


    function getMsgByType(type) {
        switch (type) {
            case 0:
                return '其他开门';
            case 1:
                return '刷卡开门';
            case 2:
                return '密码开门';
            case 3:
                return 'APP开门';
            case 4:
                return '分机开门';
            case 5:
                return '二维码开门';
            case 6:
                return '蓝牙开门';
            case 7:
                return '按钮开门';
            case 8:
                return '手机开门';
            case 9:
                return '人脸识别';
            case 10:
                return ':固定密码';
            case 11:
                return 'http开门';
            default:
                return '其它开门';
        }
    }

</script>

